import os
import pandas as pd
 
# Path to folder
folder_path = r'C:\Users\Nivedidha.Kumaravelu\OneDrive - UKBIC LTD\Documents\Scantech\Scantech4'
 
# List all CSV files
files = [f for f in os.listdir(folder_path) if f.endswith('.csv')]
print("Files to process:", files)
 
# Initialize a list to store all DataFrames
dfs = []
 
for idx, file in enumerate(files, start=1):
    file_path = os.path.join(folder_path, file)
    print(f"\nProcessing file {idx} of {len(files)}: {file_path}...")
 
    # Load CSV safely, skip malformed rows
    df = pd.read_csv(file_path, delimiter=';', on_bad_lines='skip')
 
    # Combine date and time into timestamp if columns exist
    if 'Date (YYYY-MM-DD)' in df.columns and 'Time (HH:mm:ss)' in df.columns:
        df['timestamp'] = pd.to_datetime(
            df['Date (YYYY-MM-DD)'] + ' ' + df['Time (HH:mm:ss)'],
            errors='coerce'
        )
 
    # Clean "(not relevant)" in all columns that start with Y and convert to numeric
    for col in df.columns:
        if col.startswith('Y'):
            df[col] = df[col].astype(str).str.replace(r'\(not relevant\)', '', regex=True)
            df[col] = pd.to_numeric(df[col], errors='coerce')
 
    # Add a column to track the source file
    df['source_file'] = file
 
    dfs.append(df)
 
# Combine all files into a single DataFrame
if dfs:
    final_df = pd.concat(dfs, ignore_index=True)
 
    # Move 'source_file' to the first column for easier reference
    cols = final_df.columns.tolist()
    cols.insert(0, cols.pop(cols.index('source_file')))
    final_df = final_df[cols]
 
    # Save to a CSV file
    output_file = os.path.join(folder_path, 'all_data_cleaned.csv')
    final_df.to_csv(output_file, index=False)
    print(f"\n✅ All files processed and saved to {output_file}")
else:
    print("⚠️ No valid data found to process.")
 
 
